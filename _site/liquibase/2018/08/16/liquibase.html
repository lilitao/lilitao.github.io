<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.4.0 -->
<title>liquibase increment SQL script | 李立涛</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="liquibase increment SQL script" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="summary create a database change log file include change log file into comprehensive file using db.changelog_master.xml file to aggregate change log file liquibase.properties liquibase maven plugin load data by csv create a database change log file In liquibase , using many db change log file for maintaining db meta-data or structure , These db change log includes database operation of DDL , These db change log file would resides in resources directory , like below. A change log file is a XML format file . The root element and xml schema is below: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;/databaseChangeLog&gt; When i want to create a new table named as TblLiquibaseTest , then i create a database change log xml file named as db.changelog.create.TblLiquibaseTest.xml placed into resources directory , The xml content is showing below: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;changeSet id=&quot;createtion-com.ai**ss.c**st.AppTest.LiquibaseTest&quot; author=&quot;AndyLi&quot;&gt; &lt;createTable tableName=&quot;TblLiquibaseTest&quot;&gt; &lt;column name=&quot;testId&quot; type=&quot;java.sql.Types.BIGINT&quot;&gt; &lt;constraints nullable=&quot;false&quot; primaryKey=&quot;true&quot;&gt;&lt;/constraints&gt; &lt;/column&gt; &lt;column name=&quot;testName&quot; type=&quot;java.sql.Types.VARCHAR(50)&quot;&gt; &lt;constraints nullable=&quot;true&quot;&gt;&lt;/constraints&gt; &lt;/column&gt; &lt;column name=&quot;createDate&quot; type=&quot;java.sql.Types.TIMESTAMP&quot;&gt;&lt;/column&gt; &lt;column name=&quot;status&quot; type=&quot;java.sql.Types.CHAR(1)&quot;&gt;&lt;/column&gt; &lt;/createTable&gt; &lt;/changeSet&gt; &lt;/databaseChangeLog&gt; databaseChangeLog is the root element of database change log xml chanageSet is an operation of DDL changeSet.id changeSet.author is a unique identification using by liuqibase to identify which operation has been committed or not . comprehensive file In the same directory with db.changelog.create.TblLiquibaseTest.xml , i created comprehensive file db.changelog.TblLiquibaseTest.xml to include db.changelog.create.TblLiquibaseTest.xml in order to maintain familial change log file. &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;include file=&quot;com/xx/xx/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&quot;/&gt; &lt;/databaseChangeLog&gt; db.changelog_master.xml Using db.change.master.xml to aggregated all change log files for liquibase to maintain database . Also the file should be placed in resources directory . The directory structure like below: The db.change.master.xml content contains many include elements to aggregate all change files , like this: Since i create the comprehensive file db.changelog.TblLiquibaseTest.xml for familial operation of table TblLiquibaseTest DDL , i must supplement below tag statement into db.change.master.xml &lt;include file=&quot;com/axxs/cxxst/pxm/xm/infrastructure/persistence/db.changelog.TblLiquibaseTest.xml&quot;/&gt; liquibase.properties Liquibase used properties file to configure running . A liquibase.properties should be placed in resources directory The content of liquibase.properties contexts=dbUt changeLogFile=db.changelog_p**m_master.xml driver: com.microsoft.sqlserver.jdbc.SQLServerDriver url: jdbc:sqlserver://localhost:1433;DatabaseName=XXXPOC username: sa password: *** verbose: true dropFirst: false outputChangeLogFile: db.changelog_pxx_ouput.xml dropFirst configure whether delete all table before running liuqibase maven plugin &lt;plugin&gt; &lt;groupId&gt;org.liquibase&lt;/groupId&gt; &lt;artifactId&gt;liquibase-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;propertyFileWillOverride&gt;true&lt;/propertyFileWillOverride&gt; &lt;propertyFile&gt;src/main/resources/liquibase.properties&lt;/propertyFile&gt; &lt;promptOnNonLocalDatabase&gt;false&lt;/promptOnNonLocalDatabase&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;process-resources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;updateSQL&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/configuration&gt; &lt;/plugin&gt; Because of using spring boot default liquibase version , i have no specified version of liquibase-maven-plugin plugin propertyFile specified the liquibase.properties location promptOnNonLocalDatabase is false will configure that not prompt confirm message when conecting to database After configure maven plugin ,then you will see the plugin information in Maven Project view of iNTELLIj IDEA liquibase:update Run liquibase and applies the database change logs to the databalse direct. Useful as part of the build process. liquibase:updateSQL Generates the SQL that is required to update the database to the current version as spcified in the database change logs . In real ,since i added db.changelog.create.TblLiquibaseTest.xml to project . but i do not want to applies the db.changelog.create.TblLiquibaseTest.xml to the database direct , i want to generate the SQL script for check and approval before database change log be applied. We can bundle plugin goal liquibase:updateSQL to maven phase like above configuration , and then we run command mvn package to generate the script . For comparing , i has ran mvn package before i composed db.changelog.create.TblLiquibaseTest.xml to get the scirpt in the case of no change of database. So i got the scirpt below in the directory target\liquibase\migrate.sql : -- ********************************************************************* -- Update Database Script -- ********************************************************************* -- Change Log: db.changelog_p*m_master.xml -- Ran at: 8/16/18 10:23 AM -- Against: sa@jdbc:sqlserver://CANW***3X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; -- Liquibase version: 3.6.1 -- ********************************************************************* USE C**TPOC; GO -- Lock Database UPDATE DATABASECHANGELOGLOCK SET LOCKED = 1, LOCKEDBY = &#39;CAxxxR43X (10.xx.xx.100)&#39;, LOCKGRANTED = &#39;2018-08-16T10:23:59.369&#39; WHERE ID = 1 AND LOCKED = 0 GO -- Release Database Lock UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1 GO The script show that have nothing to do Then i ran again after i composed the db.changelog.create.TblLiquibaseTest.xml , I got the script in the same directory. -- ********************************************************************* -- Update Database Script -- ********************************************************************* -- Change Log: db.changelog_p*m_master.xml -- Ran at: 8/16/18 4:23 PM -- Against: sa@jdbc:sqlserver://CANW**X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; -- Liquibase version: 3.6.1 -- ********************************************************************* USE C**TPOC; GO -- Lock Database UPDATE DATABASECHANGELOGLOCK SET LOCKED = 1, LOCKEDBY = &#39;CANWKD3**3X (10.*.*.100)&#39;, LOCKGRANTED = &#39;2018-08-16T16:23:58.314&#39; WHERE ID = 1 AND LOCKED = 0 GO -- Changeset com/a***s/co**t/p*m/*m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml::createtion-com.a**s.c**t.AppTest.LiquibaseTest::AndyLi CREATE TABLE TblLiquibaseTest (testId bigint NOT NULL, testName varchar(50), createDate datetime, status char(1), CONSTRAINT PK_TBLLIQUIBASETEST PRIMARY KEY (testId)) GO INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES (&#39;createtion-com.ai**s.c**t.AppTest.LiquibaseTest&#39;, &#39;AndyLi&#39;, &#39;com/a**s/c**st/p*m/*m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&#39;, GETDATE(), 77, &#39;8:166d6aa5138bc6e4f47c51458761f0ad&#39;, &#39;createTable tableName=TblLiquibaseTest&#39;, &#39;&#39;, &#39;EXECUTED&#39;, NULL, NULL, &#39;3.6.1&#39;, &#39;4407838779&#39;) GO -- Release Database Lock UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1 GO Compaing the script with previous script , we found that a table creaton operation DDL SQL had generated as expected . We can apply the script to database after checking and approval For executing flexibly , i can compose tow mavne profiles in pom.xml &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;local&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;properties&gt; &lt;liquibase.exec.goal&gt;update&lt;/liquibase.exec.goal&gt; &lt;liquibase.exec.prompt&gt;false&lt;/liquibase.exec.prompt&gt; &lt;liquibase.db.url&gt;jdbc:oracle:thin:@host:1521:xe&lt;/liquibase.db.url&gt; &lt;liquibase.db.user&gt;user&lt;/liquibase.db.user&gt; &lt;liquibase.db.password&gt;password&lt;/liquibase.db.password&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;uat&lt;/id&gt; &lt;properties&gt; &lt;liquibase.exec.goal&gt;updateSQL&lt;/liquibase.exec.goal&gt; &lt;liquibase.exec.prompt&gt;true&lt;/liquibase.exec.prompt&gt; &lt;liquibase.db.url&gt;jdbc:oracle:thin:@host2:1521:xe&lt;/liquibase.db.url&gt; &lt;liquibase.db.user&gt;user2&lt;/liquibase.db.user&gt; &lt;liquibase.db.password&gt;password2&lt;/liquibase.db.password&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;/profiles&gt; And update the plugin to like below, &lt;plugin&gt; &lt;groupId&gt;org.liquibase&lt;/groupId&gt; &lt;artifactId&gt;liquibase-maven-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.5&lt;/version&gt; &lt;configuration&gt; &lt;changeLogFile&gt;src/main/resources/db/liquibase_changeset.xml&lt;/changeLogFile&gt; &lt;driver&gt;oracle.jdbc.driver.OracleDriver&lt;/driver&gt; &lt;url&gt;${liquibase.db.url}&lt;/url&gt; &lt;username&gt;${liquibase.db.user}&lt;/username&gt; &lt;password&gt;${liquibase.db.password}&lt;/password&gt; &lt;promptOnNonLocalDatabase&gt;false&lt;/promptOnNonLocalDatabase&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;process-resources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;${liquibase.exec.goal}&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; After above , we can use mvn insatll -P local or mvn install -P uat in difference envrionment load data by csv We can use liquibase for loading data into database. First , create a database change log named as db.changelog.insert.TblLiquibaseTest.xml , and place into the same directory as db.changelog.create.TblLiquibaseTest.xml , and the content is below. &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;changeSet id=&quot;insertdata-com.a**s.c**t.AppTest.LiquibaseTest&quot; author=&quot;AndyLi&quot;&gt; &lt;loadUpdateData tableName=&quot;TblLiquibaseTest&quot; primaryKey=&quot;testId&quot; file=&quot;om/a**ss/c**st/p*m/*m/infrastructure/persistence/TblLiquibaseTest.csv&quot;&gt; &lt;column type=&quot;NUMERIC&quot; name=&quot;testId&quot;&gt;&lt;/column&gt; &lt;column type=&quot;STRING&quot; name=&quot;testName&quot;&gt;&lt;/column&gt; &lt;column name=&quot;createDate&quot; type=&quot;DATE&quot;&gt;&lt;/column&gt; &lt;column type=&quot;STRING&quot; name=&quot;status&quot;&gt;&lt;/column&gt; &lt;/loadUpdateData&gt; &lt;/changeSet&gt; &lt;/databaseChangeLog&gt; Second , create a csv named as TblLiquibaseTest.csv , and place into the same directory as db.changelog.insert.TblLiquibaseTest.xml , and composed data into TblLiquibaseTest.csv testId,testName,createDate,status 1,name-1,2018-08-16,A 2,name-2,2018-08-16,A 3,name-3,2018-08-16,A Third , add the db.changelog.insert.TblLiquibaseTest.xml file path into db.changelog.TblLiquibaseTest.xml , let liquibase can locate the database change log &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;include file=&quot;com/a**s/c**t/p**m/m**/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&quot;/&gt; &lt;include file=&quot;com/a**s/**st/p*m/m*/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml&quot;/&gt; &lt;/databaseChangeLog&gt; Fourth , run maven command to generate script mvn package , and execute the script in database to applies database change log -- ********************************************************************* -- Update Database Script -- ********************************************************************* -- Change Log: db.changelog_p**m_master.xml -- Ran at: 8/16/18 7:14 PM -- Against: sa@jdbc:sqlserver://CAN****43X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; -- Liquibase version: 3.6.1 -- ********************************************************************* USE C**TPOC; GO -- Lock Database UPDATE DATABASECHANGELOGLOCK SET LOCKED = 1, LOCKEDBY = &#39;CA***43X (10.65.35.100)&#39;, LOCKGRANTED = &#39;2018-08-16T19:14:16.857&#39; WHERE ID = 1 AND LOCKED = 0 GO -- Changeset com/ai**s/c**t/p**m/**m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml::createtion-com.a**s.c**st.AppTest.LiquibaseTest::AndyLi CREATE TABLE TblLiquibaseTest (testId bigint NOT NULL, testName varchar(50), createDate datetime, status char(1), CONSTRAINT PK_TBLLIQUIBASETEST PRIMARY KEY (testId)) GO INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES (&#39;createtion-com.ai**s.c**st.AppTest.LiquibaseTest&#39;, &#39;AndyLi&#39;, &#39;com/a**ss/c**t/p**m/**m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&#39;, GETDATE(), 77, &#39;8:166d6aa5138bc6e4f47c51458761f0ad&#39;, &#39;createTable tableName=TblLiquibaseTest&#39;, &#39;&#39;, &#39;EXECUTED&#39;, NULL, NULL, &#39;3.6.1&#39;, &#39;4418057268&#39;) GO -- Changeset com/a**s/c**st/p**m/**m/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml::insertdata-com.a**ss.c**st.AppTest.LiquibaseTest::AndyLi -- WARNING The following SQL may change each run and therefore is possibly incorrect and/or invalid: DECLARE @reccount integer SELECT @reccount = count(*) FROM TblLiquibaseTest WHERE testId = 1 IF @reccount = 0 BEGIN INSERT INTO TblLiquibaseTest (testId, testName, createDate, status) VALUES (1, &#39;name-1&#39;, &#39;2018-08-16&#39;, &#39;A&#39;); END ELSE BEGIN UPDATE TblLiquibaseTest SET createDate = &#39;2018-08-16&#39;, status = &#39;A&#39;, testName = &#39;name-1&#39; WHERE testId = 1; END GO DECLARE @reccount integer SELECT @reccount = count(*) FROM TblLiquibaseTest WHERE testId = 2 IF @reccount = 0 BEGIN INSERT INTO TblLiquibaseTest (testId, testName, createDate, status) VALUES (2, &#39;name-2&#39;, &#39;2018-08-16&#39;, &#39;A&#39;); END ELSE BEGIN UPDATE TblLiquibaseTest SET createDate = &#39;2018-08-16&#39;, status = &#39;A&#39;, testName = &#39;name-2&#39; WHERE testId = 2; END GO DECLARE @reccount integer SELECT @reccount = count(*) FROM TblLiquibaseTest WHERE testId = 3 IF @reccount = 0 BEGIN INSERT INTO TblLiquibaseTest (testId, testName, createDate, status) VALUES (3, &#39;name-3&#39;, &#39;2018-08-16&#39;, &#39;A&#39;); END ELSE BEGIN UPDATE TblLiquibaseTest SET createDate = &#39;2018-08-16&#39;, status = &#39;A&#39;, testName = &#39;name-3&#39; WHERE testId = 3; END GO INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES (&#39;insertdata-com.a**tss.c**st.AppTest.LiquibaseTest&#39;, &#39;AndyLi&#39;, &#39;com/a**tss/c**st/p**m/m**/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml&#39;, GETDATE(), 78, &#39;8:5c6743a4503734b3763b0ef1330edccd&#39;, &#39;loadUpdateData tableName=TblLiquibaseTest&#39;, &#39;&#39;, &#39;EXECUTED&#39;, NULL, NULL, &#39;3.6.1&#39;, &#39;4418057268&#39;) GO -- Release Database Lock UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1 GO" />
<meta property="og:description" content="summary create a database change log file include change log file into comprehensive file using db.changelog_master.xml file to aggregate change log file liquibase.properties liquibase maven plugin load data by csv create a database change log file In liquibase , using many db change log file for maintaining db meta-data or structure , These db change log includes database operation of DDL , These db change log file would resides in resources directory , like below. A change log file is a XML format file . The root element and xml schema is below: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;/databaseChangeLog&gt; When i want to create a new table named as TblLiquibaseTest , then i create a database change log xml file named as db.changelog.create.TblLiquibaseTest.xml placed into resources directory , The xml content is showing below: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;changeSet id=&quot;createtion-com.ai**ss.c**st.AppTest.LiquibaseTest&quot; author=&quot;AndyLi&quot;&gt; &lt;createTable tableName=&quot;TblLiquibaseTest&quot;&gt; &lt;column name=&quot;testId&quot; type=&quot;java.sql.Types.BIGINT&quot;&gt; &lt;constraints nullable=&quot;false&quot; primaryKey=&quot;true&quot;&gt;&lt;/constraints&gt; &lt;/column&gt; &lt;column name=&quot;testName&quot; type=&quot;java.sql.Types.VARCHAR(50)&quot;&gt; &lt;constraints nullable=&quot;true&quot;&gt;&lt;/constraints&gt; &lt;/column&gt; &lt;column name=&quot;createDate&quot; type=&quot;java.sql.Types.TIMESTAMP&quot;&gt;&lt;/column&gt; &lt;column name=&quot;status&quot; type=&quot;java.sql.Types.CHAR(1)&quot;&gt;&lt;/column&gt; &lt;/createTable&gt; &lt;/changeSet&gt; &lt;/databaseChangeLog&gt; databaseChangeLog is the root element of database change log xml chanageSet is an operation of DDL changeSet.id changeSet.author is a unique identification using by liuqibase to identify which operation has been committed or not . comprehensive file In the same directory with db.changelog.create.TblLiquibaseTest.xml , i created comprehensive file db.changelog.TblLiquibaseTest.xml to include db.changelog.create.TblLiquibaseTest.xml in order to maintain familial change log file. &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;include file=&quot;com/xx/xx/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&quot;/&gt; &lt;/databaseChangeLog&gt; db.changelog_master.xml Using db.change.master.xml to aggregated all change log files for liquibase to maintain database . Also the file should be placed in resources directory . The directory structure like below: The db.change.master.xml content contains many include elements to aggregate all change files , like this: Since i create the comprehensive file db.changelog.TblLiquibaseTest.xml for familial operation of table TblLiquibaseTest DDL , i must supplement below tag statement into db.change.master.xml &lt;include file=&quot;com/axxs/cxxst/pxm/xm/infrastructure/persistence/db.changelog.TblLiquibaseTest.xml&quot;/&gt; liquibase.properties Liquibase used properties file to configure running . A liquibase.properties should be placed in resources directory The content of liquibase.properties contexts=dbUt changeLogFile=db.changelog_p**m_master.xml driver: com.microsoft.sqlserver.jdbc.SQLServerDriver url: jdbc:sqlserver://localhost:1433;DatabaseName=XXXPOC username: sa password: *** verbose: true dropFirst: false outputChangeLogFile: db.changelog_pxx_ouput.xml dropFirst configure whether delete all table before running liuqibase maven plugin &lt;plugin&gt; &lt;groupId&gt;org.liquibase&lt;/groupId&gt; &lt;artifactId&gt;liquibase-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;propertyFileWillOverride&gt;true&lt;/propertyFileWillOverride&gt; &lt;propertyFile&gt;src/main/resources/liquibase.properties&lt;/propertyFile&gt; &lt;promptOnNonLocalDatabase&gt;false&lt;/promptOnNonLocalDatabase&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;process-resources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;updateSQL&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/configuration&gt; &lt;/plugin&gt; Because of using spring boot default liquibase version , i have no specified version of liquibase-maven-plugin plugin propertyFile specified the liquibase.properties location promptOnNonLocalDatabase is false will configure that not prompt confirm message when conecting to database After configure maven plugin ,then you will see the plugin information in Maven Project view of iNTELLIj IDEA liquibase:update Run liquibase and applies the database change logs to the databalse direct. Useful as part of the build process. liquibase:updateSQL Generates the SQL that is required to update the database to the current version as spcified in the database change logs . In real ,since i added db.changelog.create.TblLiquibaseTest.xml to project . but i do not want to applies the db.changelog.create.TblLiquibaseTest.xml to the database direct , i want to generate the SQL script for check and approval before database change log be applied. We can bundle plugin goal liquibase:updateSQL to maven phase like above configuration , and then we run command mvn package to generate the script . For comparing , i has ran mvn package before i composed db.changelog.create.TblLiquibaseTest.xml to get the scirpt in the case of no change of database. So i got the scirpt below in the directory target\liquibase\migrate.sql : -- ********************************************************************* -- Update Database Script -- ********************************************************************* -- Change Log: db.changelog_p*m_master.xml -- Ran at: 8/16/18 10:23 AM -- Against: sa@jdbc:sqlserver://CANW***3X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; -- Liquibase version: 3.6.1 -- ********************************************************************* USE C**TPOC; GO -- Lock Database UPDATE DATABASECHANGELOGLOCK SET LOCKED = 1, LOCKEDBY = &#39;CAxxxR43X (10.xx.xx.100)&#39;, LOCKGRANTED = &#39;2018-08-16T10:23:59.369&#39; WHERE ID = 1 AND LOCKED = 0 GO -- Release Database Lock UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1 GO The script show that have nothing to do Then i ran again after i composed the db.changelog.create.TblLiquibaseTest.xml , I got the script in the same directory. -- ********************************************************************* -- Update Database Script -- ********************************************************************* -- Change Log: db.changelog_p*m_master.xml -- Ran at: 8/16/18 4:23 PM -- Against: sa@jdbc:sqlserver://CANW**X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; -- Liquibase version: 3.6.1 -- ********************************************************************* USE C**TPOC; GO -- Lock Database UPDATE DATABASECHANGELOGLOCK SET LOCKED = 1, LOCKEDBY = &#39;CANWKD3**3X (10.*.*.100)&#39;, LOCKGRANTED = &#39;2018-08-16T16:23:58.314&#39; WHERE ID = 1 AND LOCKED = 0 GO -- Changeset com/a***s/co**t/p*m/*m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml::createtion-com.a**s.c**t.AppTest.LiquibaseTest::AndyLi CREATE TABLE TblLiquibaseTest (testId bigint NOT NULL, testName varchar(50), createDate datetime, status char(1), CONSTRAINT PK_TBLLIQUIBASETEST PRIMARY KEY (testId)) GO INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES (&#39;createtion-com.ai**s.c**t.AppTest.LiquibaseTest&#39;, &#39;AndyLi&#39;, &#39;com/a**s/c**st/p*m/*m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&#39;, GETDATE(), 77, &#39;8:166d6aa5138bc6e4f47c51458761f0ad&#39;, &#39;createTable tableName=TblLiquibaseTest&#39;, &#39;&#39;, &#39;EXECUTED&#39;, NULL, NULL, &#39;3.6.1&#39;, &#39;4407838779&#39;) GO -- Release Database Lock UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1 GO Compaing the script with previous script , we found that a table creaton operation DDL SQL had generated as expected . We can apply the script to database after checking and approval For executing flexibly , i can compose tow mavne profiles in pom.xml &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;local&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;properties&gt; &lt;liquibase.exec.goal&gt;update&lt;/liquibase.exec.goal&gt; &lt;liquibase.exec.prompt&gt;false&lt;/liquibase.exec.prompt&gt; &lt;liquibase.db.url&gt;jdbc:oracle:thin:@host:1521:xe&lt;/liquibase.db.url&gt; &lt;liquibase.db.user&gt;user&lt;/liquibase.db.user&gt; &lt;liquibase.db.password&gt;password&lt;/liquibase.db.password&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;uat&lt;/id&gt; &lt;properties&gt; &lt;liquibase.exec.goal&gt;updateSQL&lt;/liquibase.exec.goal&gt; &lt;liquibase.exec.prompt&gt;true&lt;/liquibase.exec.prompt&gt; &lt;liquibase.db.url&gt;jdbc:oracle:thin:@host2:1521:xe&lt;/liquibase.db.url&gt; &lt;liquibase.db.user&gt;user2&lt;/liquibase.db.user&gt; &lt;liquibase.db.password&gt;password2&lt;/liquibase.db.password&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;/profiles&gt; And update the plugin to like below, &lt;plugin&gt; &lt;groupId&gt;org.liquibase&lt;/groupId&gt; &lt;artifactId&gt;liquibase-maven-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.5&lt;/version&gt; &lt;configuration&gt; &lt;changeLogFile&gt;src/main/resources/db/liquibase_changeset.xml&lt;/changeLogFile&gt; &lt;driver&gt;oracle.jdbc.driver.OracleDriver&lt;/driver&gt; &lt;url&gt;${liquibase.db.url}&lt;/url&gt; &lt;username&gt;${liquibase.db.user}&lt;/username&gt; &lt;password&gt;${liquibase.db.password}&lt;/password&gt; &lt;promptOnNonLocalDatabase&gt;false&lt;/promptOnNonLocalDatabase&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;process-resources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;${liquibase.exec.goal}&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; After above , we can use mvn insatll -P local or mvn install -P uat in difference envrionment load data by csv We can use liquibase for loading data into database. First , create a database change log named as db.changelog.insert.TblLiquibaseTest.xml , and place into the same directory as db.changelog.create.TblLiquibaseTest.xml , and the content is below. &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;changeSet id=&quot;insertdata-com.a**s.c**t.AppTest.LiquibaseTest&quot; author=&quot;AndyLi&quot;&gt; &lt;loadUpdateData tableName=&quot;TblLiquibaseTest&quot; primaryKey=&quot;testId&quot; file=&quot;om/a**ss/c**st/p*m/*m/infrastructure/persistence/TblLiquibaseTest.csv&quot;&gt; &lt;column type=&quot;NUMERIC&quot; name=&quot;testId&quot;&gt;&lt;/column&gt; &lt;column type=&quot;STRING&quot; name=&quot;testName&quot;&gt;&lt;/column&gt; &lt;column name=&quot;createDate&quot; type=&quot;DATE&quot;&gt;&lt;/column&gt; &lt;column type=&quot;STRING&quot; name=&quot;status&quot;&gt;&lt;/column&gt; &lt;/loadUpdateData&gt; &lt;/changeSet&gt; &lt;/databaseChangeLog&gt; Second , create a csv named as TblLiquibaseTest.csv , and place into the same directory as db.changelog.insert.TblLiquibaseTest.xml , and composed data into TblLiquibaseTest.csv testId,testName,createDate,status 1,name-1,2018-08-16,A 2,name-2,2018-08-16,A 3,name-3,2018-08-16,A Third , add the db.changelog.insert.TblLiquibaseTest.xml file path into db.changelog.TblLiquibaseTest.xml , let liquibase can locate the database change log &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;include file=&quot;com/a**s/c**t/p**m/m**/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&quot;/&gt; &lt;include file=&quot;com/a**s/**st/p*m/m*/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml&quot;/&gt; &lt;/databaseChangeLog&gt; Fourth , run maven command to generate script mvn package , and execute the script in database to applies database change log -- ********************************************************************* -- Update Database Script -- ********************************************************************* -- Change Log: db.changelog_p**m_master.xml -- Ran at: 8/16/18 7:14 PM -- Against: sa@jdbc:sqlserver://CAN****43X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; -- Liquibase version: 3.6.1 -- ********************************************************************* USE C**TPOC; GO -- Lock Database UPDATE DATABASECHANGELOGLOCK SET LOCKED = 1, LOCKEDBY = &#39;CA***43X (10.65.35.100)&#39;, LOCKGRANTED = &#39;2018-08-16T19:14:16.857&#39; WHERE ID = 1 AND LOCKED = 0 GO -- Changeset com/ai**s/c**t/p**m/**m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml::createtion-com.a**s.c**st.AppTest.LiquibaseTest::AndyLi CREATE TABLE TblLiquibaseTest (testId bigint NOT NULL, testName varchar(50), createDate datetime, status char(1), CONSTRAINT PK_TBLLIQUIBASETEST PRIMARY KEY (testId)) GO INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES (&#39;createtion-com.ai**s.c**st.AppTest.LiquibaseTest&#39;, &#39;AndyLi&#39;, &#39;com/a**ss/c**t/p**m/**m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&#39;, GETDATE(), 77, &#39;8:166d6aa5138bc6e4f47c51458761f0ad&#39;, &#39;createTable tableName=TblLiquibaseTest&#39;, &#39;&#39;, &#39;EXECUTED&#39;, NULL, NULL, &#39;3.6.1&#39;, &#39;4418057268&#39;) GO -- Changeset com/a**s/c**st/p**m/**m/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml::insertdata-com.a**ss.c**st.AppTest.LiquibaseTest::AndyLi -- WARNING The following SQL may change each run and therefore is possibly incorrect and/or invalid: DECLARE @reccount integer SELECT @reccount = count(*) FROM TblLiquibaseTest WHERE testId = 1 IF @reccount = 0 BEGIN INSERT INTO TblLiquibaseTest (testId, testName, createDate, status) VALUES (1, &#39;name-1&#39;, &#39;2018-08-16&#39;, &#39;A&#39;); END ELSE BEGIN UPDATE TblLiquibaseTest SET createDate = &#39;2018-08-16&#39;, status = &#39;A&#39;, testName = &#39;name-1&#39; WHERE testId = 1; END GO DECLARE @reccount integer SELECT @reccount = count(*) FROM TblLiquibaseTest WHERE testId = 2 IF @reccount = 0 BEGIN INSERT INTO TblLiquibaseTest (testId, testName, createDate, status) VALUES (2, &#39;name-2&#39;, &#39;2018-08-16&#39;, &#39;A&#39;); END ELSE BEGIN UPDATE TblLiquibaseTest SET createDate = &#39;2018-08-16&#39;, status = &#39;A&#39;, testName = &#39;name-2&#39; WHERE testId = 2; END GO DECLARE @reccount integer SELECT @reccount = count(*) FROM TblLiquibaseTest WHERE testId = 3 IF @reccount = 0 BEGIN INSERT INTO TblLiquibaseTest (testId, testName, createDate, status) VALUES (3, &#39;name-3&#39;, &#39;2018-08-16&#39;, &#39;A&#39;); END ELSE BEGIN UPDATE TblLiquibaseTest SET createDate = &#39;2018-08-16&#39;, status = &#39;A&#39;, testName = &#39;name-3&#39; WHERE testId = 3; END GO INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES (&#39;insertdata-com.a**tss.c**st.AppTest.LiquibaseTest&#39;, &#39;AndyLi&#39;, &#39;com/a**tss/c**st/p**m/m**/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml&#39;, GETDATE(), 78, &#39;8:5c6743a4503734b3763b0ef1330edccd&#39;, &#39;loadUpdateData tableName=TblLiquibaseTest&#39;, &#39;&#39;, &#39;EXECUTED&#39;, NULL, NULL, &#39;3.6.1&#39;, &#39;4418057268&#39;) GO -- Release Database Lock UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1 GO" />
<link rel="canonical" href="http://192.168.2.102:4000/liquibase/2018/08/16/liquibase.html" />
<meta property="og:url" content="http://192.168.2.102:4000/liquibase/2018/08/16/liquibase.html" />
<meta property="og:site_name" content="李立涛" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-16T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"summary create a database change log file include change log file into comprehensive file using db.changelog_master.xml file to aggregate change log file liquibase.properties liquibase maven plugin load data by csv create a database change log file In liquibase , using many db change log file for maintaining db meta-data or structure , These db change log includes database operation of DDL , These db change log file would resides in resources directory , like below. A change log file is a XML format file . The root element and xml schema is below: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;/databaseChangeLog&gt; When i want to create a new table named as TblLiquibaseTest , then i create a database change log xml file named as db.changelog.create.TblLiquibaseTest.xml placed into resources directory , The xml content is showing below: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;changeSet id=&quot;createtion-com.ai**ss.c**st.AppTest.LiquibaseTest&quot; author=&quot;AndyLi&quot;&gt; &lt;createTable tableName=&quot;TblLiquibaseTest&quot;&gt; &lt;column name=&quot;testId&quot; type=&quot;java.sql.Types.BIGINT&quot;&gt; &lt;constraints nullable=&quot;false&quot; primaryKey=&quot;true&quot;&gt;&lt;/constraints&gt; &lt;/column&gt; &lt;column name=&quot;testName&quot; type=&quot;java.sql.Types.VARCHAR(50)&quot;&gt; &lt;constraints nullable=&quot;true&quot;&gt;&lt;/constraints&gt; &lt;/column&gt; &lt;column name=&quot;createDate&quot; type=&quot;java.sql.Types.TIMESTAMP&quot;&gt;&lt;/column&gt; &lt;column name=&quot;status&quot; type=&quot;java.sql.Types.CHAR(1)&quot;&gt;&lt;/column&gt; &lt;/createTable&gt; &lt;/changeSet&gt; &lt;/databaseChangeLog&gt; databaseChangeLog is the root element of database change log xml chanageSet is an operation of DDL changeSet.id changeSet.author is a unique identification using by liuqibase to identify which operation has been committed or not . comprehensive file In the same directory with db.changelog.create.TblLiquibaseTest.xml , i created comprehensive file db.changelog.TblLiquibaseTest.xml to include db.changelog.create.TblLiquibaseTest.xml in order to maintain familial change log file. &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;include file=&quot;com/xx/xx/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&quot;/&gt; &lt;/databaseChangeLog&gt; db.changelog_master.xml Using db.change.master.xml to aggregated all change log files for liquibase to maintain database . Also the file should be placed in resources directory . The directory structure like below: The db.change.master.xml content contains many include elements to aggregate all change files , like this: Since i create the comprehensive file db.changelog.TblLiquibaseTest.xml for familial operation of table TblLiquibaseTest DDL , i must supplement below tag statement into db.change.master.xml &lt;include file=&quot;com/axxs/cxxst/pxm/xm/infrastructure/persistence/db.changelog.TblLiquibaseTest.xml&quot;/&gt; liquibase.properties Liquibase used properties file to configure running . A liquibase.properties should be placed in resources directory The content of liquibase.properties contexts=dbUt changeLogFile=db.changelog_p**m_master.xml driver: com.microsoft.sqlserver.jdbc.SQLServerDriver url: jdbc:sqlserver://localhost:1433;DatabaseName=XXXPOC username: sa password: *** verbose: true dropFirst: false outputChangeLogFile: db.changelog_pxx_ouput.xml dropFirst configure whether delete all table before running liuqibase maven plugin &lt;plugin&gt; &lt;groupId&gt;org.liquibase&lt;/groupId&gt; &lt;artifactId&gt;liquibase-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;propertyFileWillOverride&gt;true&lt;/propertyFileWillOverride&gt; &lt;propertyFile&gt;src/main/resources/liquibase.properties&lt;/propertyFile&gt; &lt;promptOnNonLocalDatabase&gt;false&lt;/promptOnNonLocalDatabase&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;process-resources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;updateSQL&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/configuration&gt; &lt;/plugin&gt; Because of using spring boot default liquibase version , i have no specified version of liquibase-maven-plugin plugin propertyFile specified the liquibase.properties location promptOnNonLocalDatabase is false will configure that not prompt confirm message when conecting to database After configure maven plugin ,then you will see the plugin information in Maven Project view of iNTELLIj IDEA liquibase:update Run liquibase and applies the database change logs to the databalse direct. Useful as part of the build process. liquibase:updateSQL Generates the SQL that is required to update the database to the current version as spcified in the database change logs . In real ,since i added db.changelog.create.TblLiquibaseTest.xml to project . but i do not want to applies the db.changelog.create.TblLiquibaseTest.xml to the database direct , i want to generate the SQL script for check and approval before database change log be applied. We can bundle plugin goal liquibase:updateSQL to maven phase like above configuration , and then we run command mvn package to generate the script . For comparing , i has ran mvn package before i composed db.changelog.create.TblLiquibaseTest.xml to get the scirpt in the case of no change of database. So i got the scirpt below in the directory target\\liquibase\\migrate.sql : -- ********************************************************************* -- Update Database Script -- ********************************************************************* -- Change Log: db.changelog_p*m_master.xml -- Ran at: 8/16/18 10:23 AM -- Against: sa@jdbc:sqlserver://CANW***3X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; -- Liquibase version: 3.6.1 -- ********************************************************************* USE C**TPOC; GO -- Lock Database UPDATE DATABASECHANGELOGLOCK SET LOCKED = 1, LOCKEDBY = &#39;CAxxxR43X (10.xx.xx.100)&#39;, LOCKGRANTED = &#39;2018-08-16T10:23:59.369&#39; WHERE ID = 1 AND LOCKED = 0 GO -- Release Database Lock UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1 GO The script show that have nothing to do Then i ran again after i composed the db.changelog.create.TblLiquibaseTest.xml , I got the script in the same directory. -- ********************************************************************* -- Update Database Script -- ********************************************************************* -- Change Log: db.changelog_p*m_master.xml -- Ran at: 8/16/18 4:23 PM -- Against: sa@jdbc:sqlserver://CANW**X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; -- Liquibase version: 3.6.1 -- ********************************************************************* USE C**TPOC; GO -- Lock Database UPDATE DATABASECHANGELOGLOCK SET LOCKED = 1, LOCKEDBY = &#39;CANWKD3**3X (10.*.*.100)&#39;, LOCKGRANTED = &#39;2018-08-16T16:23:58.314&#39; WHERE ID = 1 AND LOCKED = 0 GO -- Changeset com/a***s/co**t/p*m/*m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml::createtion-com.a**s.c**t.AppTest.LiquibaseTest::AndyLi CREATE TABLE TblLiquibaseTest (testId bigint NOT NULL, testName varchar(50), createDate datetime, status char(1), CONSTRAINT PK_TBLLIQUIBASETEST PRIMARY KEY (testId)) GO INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES (&#39;createtion-com.ai**s.c**t.AppTest.LiquibaseTest&#39;, &#39;AndyLi&#39;, &#39;com/a**s/c**st/p*m/*m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&#39;, GETDATE(), 77, &#39;8:166d6aa5138bc6e4f47c51458761f0ad&#39;, &#39;createTable tableName=TblLiquibaseTest&#39;, &#39;&#39;, &#39;EXECUTED&#39;, NULL, NULL, &#39;3.6.1&#39;, &#39;4407838779&#39;) GO -- Release Database Lock UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1 GO Compaing the script with previous script , we found that a table creaton operation DDL SQL had generated as expected . We can apply the script to database after checking and approval For executing flexibly , i can compose tow mavne profiles in pom.xml &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;local&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;properties&gt; &lt;liquibase.exec.goal&gt;update&lt;/liquibase.exec.goal&gt; &lt;liquibase.exec.prompt&gt;false&lt;/liquibase.exec.prompt&gt; &lt;liquibase.db.url&gt;jdbc:oracle:thin:@host:1521:xe&lt;/liquibase.db.url&gt; &lt;liquibase.db.user&gt;user&lt;/liquibase.db.user&gt; &lt;liquibase.db.password&gt;password&lt;/liquibase.db.password&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;uat&lt;/id&gt; &lt;properties&gt; &lt;liquibase.exec.goal&gt;updateSQL&lt;/liquibase.exec.goal&gt; &lt;liquibase.exec.prompt&gt;true&lt;/liquibase.exec.prompt&gt; &lt;liquibase.db.url&gt;jdbc:oracle:thin:@host2:1521:xe&lt;/liquibase.db.url&gt; &lt;liquibase.db.user&gt;user2&lt;/liquibase.db.user&gt; &lt;liquibase.db.password&gt;password2&lt;/liquibase.db.password&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;/profiles&gt; And update the plugin to like below, &lt;plugin&gt; &lt;groupId&gt;org.liquibase&lt;/groupId&gt; &lt;artifactId&gt;liquibase-maven-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.5&lt;/version&gt; &lt;configuration&gt; &lt;changeLogFile&gt;src/main/resources/db/liquibase_changeset.xml&lt;/changeLogFile&gt; &lt;driver&gt;oracle.jdbc.driver.OracleDriver&lt;/driver&gt; &lt;url&gt;${liquibase.db.url}&lt;/url&gt; &lt;username&gt;${liquibase.db.user}&lt;/username&gt; &lt;password&gt;${liquibase.db.password}&lt;/password&gt; &lt;promptOnNonLocalDatabase&gt;false&lt;/promptOnNonLocalDatabase&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;process-resources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;${liquibase.exec.goal}&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; After above , we can use mvn insatll -P local or mvn install -P uat in difference envrionment load data by csv We can use liquibase for loading data into database. First , create a database change log named as db.changelog.insert.TblLiquibaseTest.xml , and place into the same directory as db.changelog.create.TblLiquibaseTest.xml , and the content is below. &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;changeSet id=&quot;insertdata-com.a**s.c**t.AppTest.LiquibaseTest&quot; author=&quot;AndyLi&quot;&gt; &lt;loadUpdateData tableName=&quot;TblLiquibaseTest&quot; primaryKey=&quot;testId&quot; file=&quot;om/a**ss/c**st/p*m/*m/infrastructure/persistence/TblLiquibaseTest.csv&quot;&gt; &lt;column type=&quot;NUMERIC&quot; name=&quot;testId&quot;&gt;&lt;/column&gt; &lt;column type=&quot;STRING&quot; name=&quot;testName&quot;&gt;&lt;/column&gt; &lt;column name=&quot;createDate&quot; type=&quot;DATE&quot;&gt;&lt;/column&gt; &lt;column type=&quot;STRING&quot; name=&quot;status&quot;&gt;&lt;/column&gt; &lt;/loadUpdateData&gt; &lt;/changeSet&gt; &lt;/databaseChangeLog&gt; Second , create a csv named as TblLiquibaseTest.csv , and place into the same directory as db.changelog.insert.TblLiquibaseTest.xml , and composed data into TblLiquibaseTest.csv testId,testName,createDate,status 1,name-1,2018-08-16,A 2,name-2,2018-08-16,A 3,name-3,2018-08-16,A Third , add the db.changelog.insert.TblLiquibaseTest.xml file path into db.changelog.TblLiquibaseTest.xml , let liquibase can locate the database change log &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;databaseChangeLog xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;include file=&quot;com/a**s/c**t/p**m/m**/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&quot;/&gt; &lt;include file=&quot;com/a**s/**st/p*m/m*/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml&quot;/&gt; &lt;/databaseChangeLog&gt; Fourth , run maven command to generate script mvn package , and execute the script in database to applies database change log -- ********************************************************************* -- Update Database Script -- ********************************************************************* -- Change Log: db.changelog_p**m_master.xml -- Ran at: 8/16/18 7:14 PM -- Against: sa@jdbc:sqlserver://CAN****43X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; -- Liquibase version: 3.6.1 -- ********************************************************************* USE C**TPOC; GO -- Lock Database UPDATE DATABASECHANGELOGLOCK SET LOCKED = 1, LOCKEDBY = &#39;CA***43X (10.65.35.100)&#39;, LOCKGRANTED = &#39;2018-08-16T19:14:16.857&#39; WHERE ID = 1 AND LOCKED = 0 GO -- Changeset com/ai**s/c**t/p**m/**m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml::createtion-com.a**s.c**st.AppTest.LiquibaseTest::AndyLi CREATE TABLE TblLiquibaseTest (testId bigint NOT NULL, testName varchar(50), createDate datetime, status char(1), CONSTRAINT PK_TBLLIQUIBASETEST PRIMARY KEY (testId)) GO INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES (&#39;createtion-com.ai**s.c**st.AppTest.LiquibaseTest&#39;, &#39;AndyLi&#39;, &#39;com/a**ss/c**t/p**m/**m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml&#39;, GETDATE(), 77, &#39;8:166d6aa5138bc6e4f47c51458761f0ad&#39;, &#39;createTable tableName=TblLiquibaseTest&#39;, &#39;&#39;, &#39;EXECUTED&#39;, NULL, NULL, &#39;3.6.1&#39;, &#39;4418057268&#39;) GO -- Changeset com/a**s/c**st/p**m/**m/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml::insertdata-com.a**ss.c**st.AppTest.LiquibaseTest::AndyLi -- WARNING The following SQL may change each run and therefore is possibly incorrect and/or invalid: DECLARE @reccount integer SELECT @reccount = count(*) FROM TblLiquibaseTest WHERE testId = 1 IF @reccount = 0 BEGIN INSERT INTO TblLiquibaseTest (testId, testName, createDate, status) VALUES (1, &#39;name-1&#39;, &#39;2018-08-16&#39;, &#39;A&#39;); END ELSE BEGIN UPDATE TblLiquibaseTest SET createDate = &#39;2018-08-16&#39;, status = &#39;A&#39;, testName = &#39;name-1&#39; WHERE testId = 1; END GO DECLARE @reccount integer SELECT @reccount = count(*) FROM TblLiquibaseTest WHERE testId = 2 IF @reccount = 0 BEGIN INSERT INTO TblLiquibaseTest (testId, testName, createDate, status) VALUES (2, &#39;name-2&#39;, &#39;2018-08-16&#39;, &#39;A&#39;); END ELSE BEGIN UPDATE TblLiquibaseTest SET createDate = &#39;2018-08-16&#39;, status = &#39;A&#39;, testName = &#39;name-2&#39; WHERE testId = 2; END GO DECLARE @reccount integer SELECT @reccount = count(*) FROM TblLiquibaseTest WHERE testId = 3 IF @reccount = 0 BEGIN INSERT INTO TblLiquibaseTest (testId, testName, createDate, status) VALUES (3, &#39;name-3&#39;, &#39;2018-08-16&#39;, &#39;A&#39;); END ELSE BEGIN UPDATE TblLiquibaseTest SET createDate = &#39;2018-08-16&#39;, status = &#39;A&#39;, testName = &#39;name-3&#39; WHERE testId = 3; END GO INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES (&#39;insertdata-com.a**tss.c**st.AppTest.LiquibaseTest&#39;, &#39;AndyLi&#39;, &#39;com/a**tss/c**st/p**m/m**/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml&#39;, GETDATE(), 78, &#39;8:5c6743a4503734b3763b0ef1330edccd&#39;, &#39;loadUpdateData tableName=TblLiquibaseTest&#39;, &#39;&#39;, &#39;EXECUTED&#39;, NULL, NULL, &#39;3.6.1&#39;, &#39;4418057268&#39;) GO -- Release Database Lock UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1 GO","@type":"BlogPosting","url":"http://192.168.2.102:4000/liquibase/2018/08/16/liquibase.html","headline":"liquibase increment SQL script","dateModified":"2018-08-16T00:00:00+08:00","datePublished":"2018-08-16T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://192.168.2.102:4000/liquibase/2018/08/16/liquibase.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://192.168.2.102:4000/feed.xml" title="李立涛" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">李立涛</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">liquibase increment SQL script</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-08-16T00:00:00+08:00" itemprop="datePublished">Aug 16, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul>
  <li>summary</li>
  <li>create a database change log file</li>
  <li>include change log file into comprehensive file</li>
  <li>using db.changelog_master.xml file to aggregate change log file</li>
  <li>liquibase.properties</li>
  <li>liquibase maven plugin</li>
  <li>load data  by csv</li>
</ul>

<h3 id="create-a-database-change-log-file">create a database change log file</h3>

<p>In liquibase , using many db change log file for maintaining db meta-data or  structure   , These db change log includes  database operation of DDL , These db change log file would resides in resources directory , like below.</p>

<p><img src="http://192.168.2.102:4000/assets/images/liquibase-changelogfile.PNG" alt="change log file" title="change log file" /></p>

<p>A change log file is a XML format file . The root element and xml schema is below:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;databaseChangeLog</span>
        <span class="na">xmlns=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"</span><span class="nt">&gt;</span>

<span class="nt">&lt;/databaseChangeLog&gt;</span> 

</code></pre></div></div>

<p>When i want to create a new table named as <code class="highlighter-rouge">TblLiquibaseTest</code> , then i create a database change log xml file named as <code class="highlighter-rouge">db.changelog.create.TblLiquibaseTest.xml</code> placed into resources directory , The xml content is showing below:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;databaseChangeLog</span>
        <span class="na">xmlns=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">"createtion-com.ai**ss.c**st.AppTest.LiquibaseTest"</span> <span class="na">author=</span><span class="s">"AndyLi"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;createTable</span> <span class="na">tableName=</span><span class="s">"TblLiquibaseTest"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"testId"</span> <span class="na">type=</span><span class="s">"java.sql.Types.BIGINT"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;constraints</span> <span class="na">nullable=</span><span class="s">"false"</span> <span class="na">primaryKey=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/constraints&gt;</span>
            <span class="nt">&lt;/column&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"testName"</span> <span class="na">type=</span><span class="s">"java.sql.Types.VARCHAR(50)"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;constraints</span> <span class="na">nullable=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/constraints&gt;</span>
            <span class="nt">&lt;/column&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"createDate"</span> <span class="na">type=</span><span class="s">"java.sql.Types.TIMESTAMP"</span><span class="nt">&gt;&lt;/column&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"status"</span> <span class="na">type=</span><span class="s">"java.sql.Types.CHAR(1)"</span><span class="nt">&gt;&lt;/column&gt;</span>
        <span class="nt">&lt;/createTable&gt;</span>
    <span class="nt">&lt;/changeSet&gt;</span>


<span class="nt">&lt;/databaseChangeLog&gt;</span>
</code></pre></div></div>
<ol>
  <li><code class="highlighter-rouge">databaseChangeLog</code> is the root element of database change log xml</li>
  <li><code class="highlighter-rouge">chanageSet</code> is an operation of DDL</li>
  <li><code class="highlighter-rouge">changeSet.id</code> <code class="highlighter-rouge">changeSet.author</code> is a unique identification using by liuqibase to identify which operation has been committed or not .</li>
</ol>

<h3 id="comprehensive-file">comprehensive file</h3>

<p>In the same directory with <code class="highlighter-rouge">db.changelog.create.TblLiquibaseTest.xml</code> , i created comprehensive file <code class="highlighter-rouge">db.changelog.TblLiquibaseTest.xml</code> to include <code class="highlighter-rouge">db.changelog.create.TblLiquibaseTest.xml</code> in order to maintain familial change log file.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;databaseChangeLog</span>
        <span class="na">xmlns=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">"com/xx/xx/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span>

</code></pre></div></div>

<h3 id="dbchangelog_masterxml">db.changelog_master.xml</h3>

<p>Using <code class="highlighter-rouge">db.change.master.xml</code> to aggregated all change log files for liquibase to maintain database . Also the file should be placed in resources directory . The directory structure like below:</p>

<p><img src="http://192.168.2.102:4000/assets/images/liquibase-changelog.master.PNG" alt="db.changelog_master.xml" /></p>

<p>The <code class="highlighter-rouge">db.change.master.xml</code> content contains many <code class="highlighter-rouge">include</code> elements to aggregate all change files , like this:</p>

<p><img src="http://192.168.2.102:4000/assets/images/liquibase-changelogfile-context.PNG" alt="db.changelog.master.xml" /></p>

<p>Since i create the comprehensive file <code class="highlighter-rouge">db.changelog.TblLiquibaseTest.xml</code> for familial operation of table <code class="highlighter-rouge">TblLiquibaseTest</code> DDL , i must supplement below tag statement into <code class="highlighter-rouge">db.change.master.xml</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">"com/axxs/cxxst/pxm/xm/infrastructure/persistence/db.changelog.TblLiquibaseTest.xml"</span><span class="nt">/&gt;</span>

</code></pre></div></div>

<h3 id="liquibaseproperties">liquibase.properties</h3>

<p>Liquibase used properties file to configure running . A <code class="highlighter-rouge">liquibase.properties</code>  should be placed in resources directory</p>

<p><img src="http://192.168.2.102:4000/assets/images/liquibase-changelog.master.PNG" alt="liquibase.properties" /></p>

<p>The content of <code class="highlighter-rouge">liquibase.properties</code></p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">contexts</span><span class="p">=</span><span class="s">dbUt</span>
<span class="py">changeLogFile</span><span class="p">=</span><span class="s">db.changelog_p**m_master.xml</span>
<span class="py">driver</span><span class="p">:</span> <span class="s">com.microsoft.sqlserver.jdbc.SQLServerDriver</span>
<span class="py">url</span><span class="p">:</span> <span class="s">jdbc:sqlserver://localhost:1433;DatabaseName=XXXPOC</span>
<span class="py">username</span><span class="p">:</span> <span class="s">sa</span>
<span class="py">password</span><span class="p">:</span> <span class="s">***</span>
<span class="py">verbose</span><span class="p">:</span> <span class="s">true</span>
<span class="py">dropFirst</span><span class="p">:</span> <span class="s">false</span>
<span class="py">outputChangeLogFile</span><span class="p">:</span> <span class="s">db.changelog_pxx_ouput.xml</span>

</code></pre></div></div>
<ol>
  <li><code class="highlighter-rouge">dropFirst</code> configure whether delete all table before running</li>
</ol>

<h3 id="liuqibase-maven-plugin">liuqibase maven plugin</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;plugin&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>org.liquibase<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>liquibase-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
   <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;propertyFileWillOverride&gt;</span>true<span class="nt">&lt;/propertyFileWillOverride&gt;</span>
        <span class="nt">&lt;propertyFile&gt;</span>src/main/resources/liquibase.properties<span class="nt">&lt;/propertyFile&gt;</span>
        <span class="nt">&lt;promptOnNonLocalDatabase&gt;</span>false<span class="nt">&lt;/promptOnNonLocalDatabase&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
              <span class="nt">&lt;execution&gt;</span>
                    <span class="nt">&lt;phase&gt;</span>process-resources<span class="nt">&lt;/phase&gt;</span>
                    <span class="nt">&lt;goals&gt;</span>
                        <span class="nt">&lt;goal&gt;</span>updateSQL<span class="nt">&lt;/goal&gt;</span>
                     <span class="nt">&lt;/goals&gt;</span>
              <span class="nt">&lt;/execution&gt;</span>
         <span class="nt">&lt;/executions&gt;</span>
   <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></div>
<ol>
  <li>Because of using spring boot default liquibase version , i have no specified <code class="highlighter-rouge">version</code> of <code class="highlighter-rouge">liquibase-maven-plugin</code> plugin</li>
  <li><code class="highlighter-rouge">propertyFile</code> specified the <code class="highlighter-rouge">liquibase.properties</code> location</li>
  <li><code class="highlighter-rouge">promptOnNonLocalDatabase</code> is false will configure that not prompt confirm message when conecting to database</li>
</ol>

<p>After configure maven plugin ,then you will see the plugin information in <code class="highlighter-rouge">Maven Project</code> view of <code class="highlighter-rouge">iNTELLIj IDEA</code></p>

<p><img src="http://192.168.2.102:4000/assets/images/liquibase-maven-plugin.PNG" alt="maven plugin" /></p>

<ol>
  <li><code class="highlighter-rouge">liquibase:update</code> Run liquibase and applies the database change logs to the databalse direct. Useful as part of the build process.</li>
  <li><code class="highlighter-rouge">liquibase:updateSQL</code> Generates the SQL that is required to update the database to the current version as spcified in the database change logs .</li>
</ol>

<p>In real ,since i added <code class="highlighter-rouge">db.changelog.create.TblLiquibaseTest.xml</code>  to project . but  i do not want to applies the <code class="highlighter-rouge">db.changelog.create.TblLiquibaseTest.xml</code> to the database direct , i want to generate the SQL script for check and approval before database change log be applied. We can bundle plugin goal <code class="highlighter-rouge">liquibase:updateSQL</code> to maven phase like above configuration  , and then we run command <code class="highlighter-rouge">mvn package</code>  to generate the script .</p>

<p>For comparing , i has ran <code class="highlighter-rouge">mvn package</code> before i composed <code class="highlighter-rouge">db.changelog.create.TblLiquibaseTest.xml</code> to get the scirpt in the case of no change of database. So i got the scirpt below in the directory <code class="highlighter-rouge">target\liquibase\migrate.sql</code> :</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- *********************************************************************</span>
<span class="c1">-- Update Database Script</span>
<span class="c1">-- *********************************************************************</span>
<span class="c1">-- Change Log: db.changelog_p*m_master.xml</span>
<span class="c1">-- Ran at: 8/16/18 10:23 AM</span>
<span class="c1">-- Against: sa@jdbc:sqlserver://CANW***3X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite;</span>
<span class="c1">-- Liquibase version: 3.6.1</span>
<span class="c1">-- *********************************************************************</span>

<span class="n">USE</span> <span class="k">C</span><span class="o">**</span><span class="n">TPOC</span><span class="p">;</span>
<span class="k">GO</span>

<span class="c1">-- Lock Database</span>
<span class="k">UPDATE</span> <span class="n">DATABASECHANGELOGLOCK</span> <span class="k">SET</span> <span class="n">LOCKED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LOCKEDBY</span> <span class="o">=</span> <span class="s1">'CAxxxR43X (10.xx.xx.100)'</span><span class="p">,</span> <span class="n">LOCKGRANTED</span> <span class="o">=</span> <span class="s1">'2018-08-16T10:23:59.369'</span> <span class="k">WHERE</span> <span class="n">ID</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">AND</span> <span class="n">LOCKED</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">GO</span>

<span class="c1">-- Release Database Lock</span>
<span class="k">UPDATE</span> <span class="n">DATABASECHANGELOGLOCK</span> <span class="k">SET</span> <span class="n">LOCKED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">LOCKEDBY</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">LOCKGRANTED</span> <span class="o">=</span> <span class="k">NULL</span> <span class="k">WHERE</span> <span class="n">ID</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">GO</span>


</code></pre></div></div>

<p>The script show that have nothing to do</p>

<p>Then i ran again after i composed the <code class="highlighter-rouge">db.changelog.create.TblLiquibaseTest.xml</code> , I got the script in the same directory.</p>

<pre><code class="language-SQL">-- *********************************************************************
-- Update Database Script
-- *********************************************************************
-- Change Log: db.changelog_p*m_master.xml
-- Ran at: 8/16/18 4:23 PM
-- Against: sa@jdbc:sqlserver://CANW**X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite;
-- Liquibase version: 3.6.1
-- *********************************************************************

USE C**TPOC;
GO

-- Lock Database
UPDATE DATABASECHANGELOGLOCK SET LOCKED = 1, LOCKEDBY = 'CANWKD3**3X (10.*.*.100)', LOCKGRANTED = '2018-08-16T16:23:58.314' WHERE ID = 1 AND LOCKED = 0
GO

-- Changeset com/a***s/co**t/p*m/*m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml::createtion-com.a**s.c**t.AppTest.LiquibaseTest::AndyLi
CREATE TABLE TblLiquibaseTest (testId bigint NOT NULL, testName varchar(50), createDate datetime, status char(1), CONSTRAINT PK_TBLLIQUIBASETEST PRIMARY KEY (testId))
GO

INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES ('createtion-com.ai**s.c**t.AppTest.LiquibaseTest', 'AndyLi', 'com/a**s/c**st/p*m/*m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml', GETDATE(), 77, '8:166d6aa5138bc6e4f47c51458761f0ad', 'createTable tableName=TblLiquibaseTest', '', 'EXECUTED', NULL, NULL, '3.6.1', '4407838779')
GO

-- Release Database Lock
UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1
GO
</code></pre>

<p>Compaing the script with previous script , we found that a table creaton operation DDL SQL had generated as expected . We can apply the script to database after checking and approval</p>

<p>For  executing flexibly ,  i can compose tow mavne profiles in <code class="highlighter-rouge">pom.xml</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
        <span class="nt">&lt;id&gt;</span>local<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;activation&gt;</span>
            <span class="nt">&lt;activeByDefault&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
        <span class="nt">&lt;/activation&gt;</span>
        <span class="nt">&lt;properties&gt;</span>
            <span class="nt">&lt;liquibase.exec.goal&gt;</span>update<span class="nt">&lt;/liquibase.exec.goal&gt;</span>
            <span class="nt">&lt;liquibase.exec.prompt&gt;</span>false<span class="nt">&lt;/liquibase.exec.prompt&gt;</span>
            <span class="nt">&lt;liquibase.db.url&gt;</span>jdbc:oracle:thin:@host:1521:xe<span class="nt">&lt;/liquibase.db.url&gt;</span>
            <span class="nt">&lt;liquibase.db.user&gt;</span>user<span class="nt">&lt;/liquibase.db.user&gt;</span>
            <span class="nt">&lt;liquibase.db.password&gt;</span>password<span class="nt">&lt;/liquibase.db.password&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>

    <span class="nt">&lt;profile&gt;</span>
        <span class="nt">&lt;id&gt;</span>uat<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;properties&gt;</span>
            <span class="nt">&lt;liquibase.exec.goal&gt;</span>updateSQL<span class="nt">&lt;/liquibase.exec.goal&gt;</span>
            <span class="nt">&lt;liquibase.exec.prompt&gt;</span>true<span class="nt">&lt;/liquibase.exec.prompt&gt;</span>
            <span class="nt">&lt;liquibase.db.url&gt;</span>jdbc:oracle:thin:@host2:1521:xe<span class="nt">&lt;/liquibase.db.url&gt;</span>
            <span class="nt">&lt;liquibase.db.user&gt;</span>user2<span class="nt">&lt;/liquibase.db.user&gt;</span>
            <span class="nt">&lt;liquibase.db.password&gt;</span>password2<span class="nt">&lt;/liquibase.db.password&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>
</code></pre></div></div>

<p>And update the plugin to like below,</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.liquibase<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>liquibase-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.0.5<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;changeLogFile&gt;</span>src/main/resources/db/liquibase_changeset.xml<span class="nt">&lt;/changeLogFile&gt;</span>
        <span class="nt">&lt;driver&gt;</span>oracle.jdbc.driver.OracleDriver<span class="nt">&lt;/driver&gt;</span>
        <span class="nt">&lt;url&gt;</span>${liquibase.db.url}<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;username&gt;</span>${liquibase.db.user}<span class="nt">&lt;/username&gt;</span>
        <span class="nt">&lt;password&gt;</span>${liquibase.db.password}<span class="nt">&lt;/password&gt;</span>
        <span class="nt">&lt;promptOnNonLocalDatabase&gt;</span>false<span class="nt">&lt;/promptOnNonLocalDatabase&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;phase&gt;</span>process-resources<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
                <span class="nt">&lt;goal&gt;</span>${liquibase.exec.goal}<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
    <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>

</code></pre></div></div>

<p>After above , we can use <code class="highlighter-rouge">mvn insatll -P local</code> or <code class="highlighter-rouge">mvn install -P uat</code> in difference envrionment</p>

<h3 id="load-data-by-csv">load data by csv</h3>

<p>We can use liquibase for loading data into database.
First , create a database change log named as <code class="highlighter-rouge">db.changelog.insert.TblLiquibaseTest.xml</code> , and place into the same directory as <code class="highlighter-rouge">db.changelog.create.TblLiquibaseTest.xml</code> , and the content is below.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;databaseChangeLog</span>
        <span class="na">xmlns=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">"insertdata-com.a**s.c**t.AppTest.LiquibaseTest"</span> <span class="na">author=</span><span class="s">"AndyLi"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;loadUpdateData</span> <span class="na">tableName=</span><span class="s">"TblLiquibaseTest"</span> <span class="na">primaryKey=</span><span class="s">"testId"</span> <span class="na">file=</span><span class="s">"om/a**ss/c**st/p*m/*m/infrastructure/persistence/TblLiquibaseTest.csv"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">type=</span><span class="s">"NUMERIC"</span> <span class="na">name=</span><span class="s">"testId"</span><span class="nt">&gt;&lt;/column&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">type=</span><span class="s">"STRING"</span> <span class="na">name=</span><span class="s">"testName"</span><span class="nt">&gt;&lt;/column&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"createDate"</span> <span class="na">type=</span><span class="s">"DATE"</span><span class="nt">&gt;&lt;/column&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">type=</span><span class="s">"STRING"</span> <span class="na">name=</span><span class="s">"status"</span><span class="nt">&gt;&lt;/column&gt;</span>
        <span class="nt">&lt;/loadUpdateData&gt;</span>

    <span class="nt">&lt;/changeSet&gt;</span>

<span class="nt">&lt;/databaseChangeLog&gt;</span>

</code></pre></div></div>

<p>Second , create a  csv named as <code class="highlighter-rouge">TblLiquibaseTest.csv</code> , and place into the same directory as <code class="highlighter-rouge">db.changelog.insert.TblLiquibaseTest.xml</code> , and composed data into <code class="highlighter-rouge">TblLiquibaseTest.csv</code></p>

<pre><code class="language-txt">testId,testName,createDate,status
1,name-1,2018-08-16,A
2,name-2,2018-08-16,A
3,name-3,2018-08-16,A


</code></pre>

<p>Third , add the <code class="highlighter-rouge">db.changelog.insert.TblLiquibaseTest.xml</code> file path into <code class="highlighter-rouge">db.changelog.TblLiquibaseTest.xml</code> , let liquibase can locate the database change log</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;databaseChangeLog</span>
        <span class="na">xmlns=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">"com/a**s/c**t/p**m/m**/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">"com/a**s/**st/p*m/m*/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span>
</code></pre></div></div>

<p>Fourth , run maven command to generate script <code class="highlighter-rouge">mvn package</code> , and execute the script in database to applies database change log</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">-- *********************************************************************</span>
<span class="c1">-- Update Database Script</span>
<span class="c1">-- *********************************************************************</span>
<span class="c1">-- Change Log: db.changelog_p**m_master.xml</span>
<span class="c1">-- Ran at: 8/16/18 7:14 PM</span>
<span class="c1">-- Against: sa@jdbc:sqlserver://CAN****43X:1433;authenticationScheme=nativeAuthentication;xopenStates=false;sendTimeAsDatetime=true;trustServerCertificate=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;packetSize=8000;multiSubnetFailover=false;loginTimeout=15;lockTimeout=-1;lastUpdateCount=true;encrypt=false;disableStatementPooling=true;databaseName=C**TPOC;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite;</span>
<span class="c1">-- Liquibase version: 3.6.1</span>
<span class="c1">-- *********************************************************************</span>

<span class="n">USE</span> <span class="k">C</span><span class="o">**</span><span class="n">TPOC</span><span class="p">;</span>
<span class="k">GO</span>

<span class="c1">-- Lock Database</span>
<span class="k">UPDATE</span> <span class="n">DATABASECHANGELOGLOCK</span> <span class="k">SET</span> <span class="n">LOCKED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LOCKEDBY</span> <span class="o">=</span> <span class="s1">'CA***43X (10.65.35.100)'</span><span class="p">,</span> <span class="n">LOCKGRANTED</span> <span class="o">=</span> <span class="s1">'2018-08-16T19:14:16.857'</span> <span class="k">WHERE</span> <span class="n">ID</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">AND</span> <span class="n">LOCKED</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">GO</span>

<span class="c1">-- Changeset com/ai**s/c**t/p**m/**m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml::createtion-com.a**s.c**st.AppTest.LiquibaseTest::AndyLi</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">TblLiquibaseTest</span> <span class="p">(</span><span class="n">testId</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">testName</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">createDate</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">status</span> <span class="n">char</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">CONSTRAINT</span> <span class="n">PK_TBLLIQUIBASETEST</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">testId</span><span class="p">))</span>
<span class="k">GO</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DATABASECHANGELOG</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">AUTHOR</span><span class="p">,</span> <span class="n">FILENAME</span><span class="p">,</span> <span class="n">DATEEXECUTED</span><span class="p">,</span> <span class="n">ORDEREXECUTED</span><span class="p">,</span> <span class="n">MD5SUM</span><span class="p">,</span> <span class="n">DESCRIPTION</span><span class="p">,</span> <span class="n">COMMENTS</span><span class="p">,</span> <span class="n">EXECTYPE</span><span class="p">,</span> <span class="n">CONTEXTS</span><span class="p">,</span> <span class="n">LABELS</span><span class="p">,</span> <span class="n">LIQUIBASE</span><span class="p">,</span> <span class="n">DEPLOYMENT_ID</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'createtion-com.ai**s.c**st.AppTest.LiquibaseTest'</span><span class="p">,</span> <span class="s1">'AndyLi'</span><span class="p">,</span> <span class="s1">'com/a**ss/c**t/p**m/**m/infrastructure/persistence/db.changelog.create.TblLiquibaseTest.xml'</span><span class="p">,</span> <span class="n">GETDATE</span><span class="p">(),</span> <span class="mi">77</span><span class="p">,</span> <span class="s1">'8:166d6aa5138bc6e4f47c51458761f0ad'</span><span class="p">,</span> <span class="s1">'createTable tableName=TblLiquibaseTest'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'EXECUTED'</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="s1">'3.6.1'</span><span class="p">,</span> <span class="s1">'4418057268'</span><span class="p">)</span>
<span class="k">GO</span>

<span class="c1">-- Changeset com/a**s/c**st/p**m/**m/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml::insertdata-com.a**ss.c**st.AppTest.LiquibaseTest::AndyLi</span>
<span class="c1">-- WARNING The following SQL may change each run and therefore is possibly incorrect and/or invalid:</span>
<span class="k">DECLARE</span> <span class="o">@</span><span class="n">reccount</span> <span class="n">integer</span>
<span class="k">SELECT</span> <span class="o">@</span><span class="n">reccount</span> <span class="o">=</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">TblLiquibaseTest</span> <span class="k">WHERE</span> <span class="n">testId</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">IF</span> <span class="o">@</span><span class="n">reccount</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">BEGIN</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">TblLiquibaseTest</span> <span class="p">(</span><span class="n">testId</span><span class="p">,</span> <span class="n">testName</span><span class="p">,</span> <span class="n">createDate</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'name-1'</span><span class="p">,</span> <span class="s1">'2018-08-16'</span><span class="p">,</span> <span class="s1">'A'</span><span class="p">);</span>
<span class="k">END</span>
<span class="k">ELSE</span>
<span class="k">BEGIN</span>
<span class="k">UPDATE</span> <span class="n">TblLiquibaseTest</span> <span class="k">SET</span> <span class="n">createDate</span> <span class="o">=</span> <span class="s1">'2018-08-16'</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">'A'</span><span class="p">,</span> <span class="n">testName</span> <span class="o">=</span> <span class="s1">'name-1'</span> <span class="k">WHERE</span> <span class="n">testId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">END</span>
<span class="k">GO</span>

<span class="k">DECLARE</span> <span class="o">@</span><span class="n">reccount</span> <span class="n">integer</span>
<span class="k">SELECT</span> <span class="o">@</span><span class="n">reccount</span> <span class="o">=</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">TblLiquibaseTest</span> <span class="k">WHERE</span> <span class="n">testId</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">IF</span> <span class="o">@</span><span class="n">reccount</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">BEGIN</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">TblLiquibaseTest</span> <span class="p">(</span><span class="n">testId</span><span class="p">,</span> <span class="n">testName</span><span class="p">,</span> <span class="n">createDate</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'name-2'</span><span class="p">,</span> <span class="s1">'2018-08-16'</span><span class="p">,</span> <span class="s1">'A'</span><span class="p">);</span>
<span class="k">END</span>
<span class="k">ELSE</span>
<span class="k">BEGIN</span>
<span class="k">UPDATE</span> <span class="n">TblLiquibaseTest</span> <span class="k">SET</span> <span class="n">createDate</span> <span class="o">=</span> <span class="s1">'2018-08-16'</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">'A'</span><span class="p">,</span> <span class="n">testName</span> <span class="o">=</span> <span class="s1">'name-2'</span> <span class="k">WHERE</span> <span class="n">testId</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">END</span>
<span class="k">GO</span>

<span class="k">DECLARE</span> <span class="o">@</span><span class="n">reccount</span> <span class="n">integer</span>
<span class="k">SELECT</span> <span class="o">@</span><span class="n">reccount</span> <span class="o">=</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">TblLiquibaseTest</span> <span class="k">WHERE</span> <span class="n">testId</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">IF</span> <span class="o">@</span><span class="n">reccount</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">BEGIN</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">TblLiquibaseTest</span> <span class="p">(</span><span class="n">testId</span><span class="p">,</span> <span class="n">testName</span><span class="p">,</span> <span class="n">createDate</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'name-3'</span><span class="p">,</span> <span class="s1">'2018-08-16'</span><span class="p">,</span> <span class="s1">'A'</span><span class="p">);</span>
<span class="k">END</span>
<span class="k">ELSE</span>
<span class="k">BEGIN</span>
<span class="k">UPDATE</span> <span class="n">TblLiquibaseTest</span> <span class="k">SET</span> <span class="n">createDate</span> <span class="o">=</span> <span class="s1">'2018-08-16'</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">'A'</span><span class="p">,</span> <span class="n">testName</span> <span class="o">=</span> <span class="s1">'name-3'</span> <span class="k">WHERE</span> <span class="n">testId</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">END</span>
<span class="k">GO</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DATABASECHANGELOG</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">AUTHOR</span><span class="p">,</span> <span class="n">FILENAME</span><span class="p">,</span> <span class="n">DATEEXECUTED</span><span class="p">,</span> <span class="n">ORDEREXECUTED</span><span class="p">,</span> <span class="n">MD5SUM</span><span class="p">,</span> <span class="n">DESCRIPTION</span><span class="p">,</span> <span class="n">COMMENTS</span><span class="p">,</span> <span class="n">EXECTYPE</span><span class="p">,</span> <span class="n">CONTEXTS</span><span class="p">,</span> <span class="n">LABELS</span><span class="p">,</span> <span class="n">LIQUIBASE</span><span class="p">,</span> <span class="n">DEPLOYMENT_ID</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'insertdata-com.a**tss.c**st.AppTest.LiquibaseTest'</span><span class="p">,</span> <span class="s1">'AndyLi'</span><span class="p">,</span> <span class="s1">'com/a**tss/c**st/p**m/m**/infrastructure/persistence/db.changelog.insert.TblLiquibaseTest.xml'</span><span class="p">,</span> <span class="n">GETDATE</span><span class="p">(),</span> <span class="mi">78</span><span class="p">,</span> <span class="s1">'8:5c6743a4503734b3763b0ef1330edccd'</span><span class="p">,</span> <span class="s1">'loadUpdateData tableName=TblLiquibaseTest'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'EXECUTED'</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="s1">'3.6.1'</span><span class="p">,</span> <span class="s1">'4418057268'</span><span class="p">)</span>
<span class="k">GO</span>

<span class="c1">-- Release Database Lock</span>
<span class="k">UPDATE</span> <span class="n">DATABASECHANGELOGLOCK</span> <span class="k">SET</span> <span class="n">LOCKED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">LOCKEDBY</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">LOCKGRANTED</span> <span class="o">=</span> <span class="k">NULL</span> <span class="k">WHERE</span> <span class="n">ID</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">GO</span>


</code></pre></div></div>

  </div><a class="u-url" href="/liquibase/2018/08/16/liquibase.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">李立涛</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">李立涛</li><li><a class="u-email" href="mailto:43850338@qq.com">43850338@qq.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Welcome to My Blog</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
